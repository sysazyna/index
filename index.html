<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>歴史マスター【入試完全網羅】</title>
    <style>
        :root { --main: #2c3e50; --accent: #3498db; --correct: #27ae60; --wrong: #e74c3c; --check: #f1c40f; --bg: #f4f7f9; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; -webkit-tap-highlight-color: transparent; }
        .container { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 4px 25px rgba(0,0,0,0.1); width: 100%; max-width: 500px; box-sizing: border-box; }
        .nav-row { display: flex; justify-content: space-between; margin-bottom: 10px; width: 100%; }
        .small-btn { padding: 8px 12px; font-size: 0.75rem; border: 1px solid #ccc; background: white; border-radius: 6px; color: #666; cursor: pointer; }
        .bar-bg { width: 100%; height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden; margin: 5px 0 15px 0; }
        .bar-fill { height: 100%; background: var(--correct); width: 0%; transition: 0.4s; }
        .stats { display: flex; justify-content: space-between; font-size: 0.8rem; color: #7f8c8d; font-weight: bold; }
        h2 { font-size: 1.1rem; color: var(--main); margin: 10px 0; text-align: center; line-height: 1.4; }
        .menu-btn { width: 100%; margin: 7px 0; padding: 16px; border: 2px solid var(--accent); background: white; border-radius: 12px; font-weight: bold; color: var(--accent); font-size: 1rem; cursor: pointer; }
        .choice-btn { width: 100%; margin: 8px 0; padding: 16px; border: none; background: #f0f3f5; border-radius: 12px; font-weight: bold; text-align: left; cursor: pointer; }
        .order-item { background: #fff; border: 2px solid #dfe6e9; margin: 10px 0; padding: 16px; border-radius: 12px; font-weight: bold; position: relative; cursor: pointer; user-select: none; }
        .order-item.selected { border-color: var(--accent); background: #e3f2fd; color: var(--accent); }
        .num-circle { position: absolute; right: 15px; background: var(--accent); color: white; border-radius: 50%; width: 22px; height: 22px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; }
        .res-card { display: none; margin-top: 20px; padding: 18px; border-radius: 12px; background: #fff9db; border: 1px solid #f9e79f; }
        .exp-txt { font-size: 0.9rem; color: #444; margin: 10px 0; line-height: 1.6; border-top: 1px solid #eee; padding-top: 10px; }
        .next-btn { width: 100%; padding: 16px; background: var(--main); color: white; border: none; border-radius: 12px; font-weight: bold; margin-top: 12px; cursor: pointer; }
        .star-btn { width: 100%; padding: 10px; background: var(--check); color: white; border: none; border-radius: 8px; font-weight: bold; margin-bottom: 5px; font-size: 0.85rem; cursor: pointer; }
    </style>
</head>
<body>

<div id="auth-screen" style="display:block; text-align:center; padding-top:50px;">
    <h2>合言葉を入力してください</h2>
    <input type="password" id="pass-input" style="padding:10px; font-size:1.2rem; width:150px; text-align:center; border-radius:8px; border:1px solid #ccc;">
    <button onclick="checkPass()" style="padding:10px 20px; background:var(--accent); color:white; border:none; border-radius:8px; margin-top:10px; cursor:pointer;">入室</button>
</div>

<div class="container" id="main-app" style="display:none;">
    <div id="nav-bar" class="nav-row" style="display:none;">
        <button class="small-btn" onclick="backToMenu()">最初に戻る</button>
        <button id="back-btn" class="small-btn" onclick="goBack()">前に戻る</button>
    </div>

    <div id="prog-ui" style="display:none;">
        <div class="stats"><span id="prog-txt">0/0 問</span><span>正解: <span id="session-correct">0</span></span></div>
        <div class="bar-bg"><div id="bar-fill" class="bar-fill"></div></div>
    </div>

    <div id="menu">
        <h2>歴史マスター【全113項目】</h2>
        <button class="menu-btn" onclick="startQuiz('meiji')">明治・幕末 (48問)</button>
        <button class="menu-btn" onclick="startQuiz('taisho')">大正・昭和前期 (29問)</button>
        <button class="menu-btn" onclick="startQuiz('modern')">昭和後期〜現代 (36問)</button>
        <button class="menu-btn" style="background:var(--accent); color:white;" onclick="startQuiz('all')">全範囲モード (113問)</button>
        <button id="weak-btn" class="menu-btn" style="border-color:var(--wrong); color:var(--wrong); display:none;" onclick="startQuiz('weak')">苦手・自信なし 復習モード</button>
    </div>

    <div id="quiz" style="display:none;">
        <h2 id="q-txt"></h2>
        <div id="choices"></div>
        <div id="orders"></div>
        <button id="decide-btn" class="next-btn" style="background:var(--accent); display:none;" onclick="evalOrder()">決定して判定</button>
        <div id="res-box" class="res-card">
            <div id="judge-txt" style="font-weight:bold; font-size:1.1rem;"></div>
            <div id="exp-txt" class="exp-txt"></div>
            <button class="star-btn" id="star-btn" onclick="toggleStar()">★ 自信がない（後で復習）</button>
            <button class="next-btn" onclick="goNext()">次の問題へ</button>
        </div>
    </div>

    <div id="summary" style="display:none; text-align:center;">
        <h2 style="font-size:1.5rem;">完了！</h2>
        <div style="font-size:3rem; font-weight:bold; color:var(--accent);" id="final-pct">0%</div>
        <textarea id="gemini-text" style="width:100%; height:80px; font-size:0.75rem; margin-top:15px;" readonly></textarea>
        <button class="small-btn" style="width:100%; background:#5d6d7e; color:white; margin-top:5px; padding:10px;" onclick="copyGemini()">相談テキストをコピー</button>
        <button class="next-btn" onclick="backToMenu()">メニューに戻る</button>
    </div>
</div>

<script>
const FAMILY_PASS = "2025";
function checkPass() {
    if(document.getElementById('pass-input').value === FAMILY_PASS) {
        document.getElementById('auth-screen').style.display = 'none';
        document.getElementById('main-app').style.display = 'block';
        updateWeakBtn();
    } else { alert("合言葉が違います"); }
}

// 厳格な113項目リソース
const db = [
    {id:1,y:1853,e:"ペリー来航",c:"meiji",d:"浦賀に黒船。開国要求。"},{id:2,y:1854,e:"日米和親条約",c:"meiji",d:"下田・函館開港。鎖国終了。"},{id:3,y:1858,e:"日米修好通商条約",c:"meiji",d:"不平等条約。関税自主権なし。"},
    {id:4,y:1859,e:"安政の大獄",c:"meiji",d:"井伊直弼による弾圧。"},{id:5,y:1860,e:"桜田門外の変",c:"meiji",d:"井伊直弼暗殺。"},{id:6,y:1862,e:"生麦事件",c:"meiji",d:"薩摩藩士がイギリス人殺傷。"},
    {id:7,y:1863,e:"薩英戦争",c:"meiji",d:"薩摩とイギリスの戦い。"},{id:8,y:1863,e:"下関事件",c:"meiji",d:"長州が外国船を砲撃。"},{id:9,y:1866,e:"薩長同盟",c:"meiji",d:"坂本龍馬の仲介。"},
    {id:10,y:1867,e:"大政奉還",c:"meiji",d:"徳川慶喜が政権返上。"},{id:11,y:1867,e:"王政復古の大号令",c:"meiji",d:"新政府樹立宣言。"},{id:12,y:1868,e:"戊辰戦争",c:"meiji",d:"旧幕府軍との内戦。"},
    {id:13,y:1868,e:"五箇条の御誓文",c:"meiji",d:"明治政府の基本方針。"},{id:14,y:1869,e:"版籍奉還",c:"meiji",d:"土地人民を天皇へ。"},{id:15,y:1871,e:"廃藩置県",c:"meiji",d:"中央集権化。"},
    {id:16,y:1871,e:"解放令",c:"meiji",d:"身分差別廃止。"},{id:17,y:1871,e:"日清修好条規",c:"meiji",d:"清との対等条約。"},{id:18,y:1872,e:"学制",c:"meiji",d:"近代教育開始。"},
    {id:19,y:1872,e:"富岡製糸場",c:"meiji",d:"官営模範工場。"},{id:20,y:1873,e:"徴兵令",c:"meiji",d:"国民兵役義務。"},{id:21,y:1873,e:"地租改正",c:"meiji",d:"現金納税開始。"},
    {id:22,y:1874,e:"民撰議院設立建白書",c:"meiji",d:"自由民権の端緒。"},{id:23,y:1874,e:"自由民権運動",c:"meiji",d:"民主化運動。"},{id:24,y:1876,e:"日朝修好条規",c:"meiji",d:"朝鮮開国。不平等条約。"},
    {id:25,y:1877,e:"西南戦争",c:"meiji",d:"西郷隆盛の士族反乱。"},{id:26,y:1880,e:"国会期成同盟",c:"meiji",d:"国会開設運動。"},{id:27,y:1881,e:"国会開設の勅諭",c:"meiji",d:"10年後約束。"},
    {id:28,y:1884,e:"秩父事件",c:"meiji",d:"農民武装蜂起。"},{id:29,y:1885,e:"内閣制度",c:"meiji",d:"伊藤博文初代首相。"},{id:30,y:1886,e:"ノルマントン号事件",c:"meiji",d:"不平等条約への不満。"},
    {id:31,y:1889,e:"大日本帝国憲法発布",c:"meiji",d:"天皇主権憲法。"},{id:32,y:1890,e:"第1回帝国議会",c:"meiji",d:"議会政治開始。"},{id:33,y:1890,e:"教育勅語",c:"meiji",d:"道徳規範。"},
    {id:34,y:1894,e:"治外法権撤廃",c:"meiji",d:"陸奥宗光の成果。"},{id:35,y:1894,e:"甲午農民戦争",c:"meiji",d:"朝鮮での農民反乱。"},{id:36,y:1894,e:"日清戦争",c:"meiji",d:"日本vs清。"},
    {id:37,y:1895,e:"下関条約",c:"meiji",d:"日清講和条約。"},{id:38,y:1895,e:"三国干渉",c:"meiji",d:"露独仏の圧力。"},{id:39,y:1900,e:"義和団事件",c:"meiji",d:"清での排外運動。"},
    {id:40,y:1901,e:"八幡製鉄所",c:"meiji",d:"重工業発展の拠点。"},{id:41,y:1902,e:"日英同盟",c:"meiji",d:"対ロシア同盟。"},{id:42,y:1904,e:"日露戦争",c:"meiji",d:"日本vsロシア。"},
    {id:43,y:1905,e:"ポーツマス条約",c:"meiji",d:"日露講和条約。"},{id:44,y:1910,e:"韓国併合",c:"meiji",d:"日本の支配下に。"},{id:45,y:1910,e:"大逆事件",c:"meiji",d:"社会主義者処罰。"},
    {id:46,y:1911,e:"関税自主権回復",c:"meiji",d:"小村寿太郎が成功。"},{id:47,y:1911,e:"辛亥革命",c:"meiji",d:"清が倒れ中華民国へ。"},
    {id:48,y:1914,e:"第一次世界大戦参戦",c:"taisho",d:"日英同盟を理由に。"},{id:49,y:1914,e:"サラエボ事件",c:"taisho",d:"1次大戦の契機。"},{id:50,y:1914,e:"第一次世界大戦",c:"taisho",d:"世界規模の大戦。"},
    {id:51,y:1915,e:"二十一か条の要求",c:"taisho",d:"中国への要求。"},{id:52,y:1917,e:"ロシア革命",c:"taisho",d:"社会主義国誕生。"},{id:53,y:1918,e:"シベリア出兵",c:"taisho",d:"革命干渉軍。"},
    {id:54,y:1918,e:"米騒動",c:"taisho",d:"米価高騰への暴動。"},{id:55,y:1918,e:"原敬内閣発足",c:"taisho",d:"本格政党内閣。"},{id:56,y:1919,e:"ベルサイユ条約",c:"taisho",d:"1次大戦の講和。"},
    {id:57,y:1919,e:"三・一独立運動",c:"taisho",d:"朝鮮の独立運動。"},{id:58,y:1919,e:"五・四運動",c:"taisho",d:"中国の民衆運動。"},{id:59,y:1920,e:"国際連盟",c:"taisho",d:"平和維持組織。"},
    {id:60,y:1921,e:"ワシントン会議",c:"taisho",d:"軍縮合意。"},{id:61,y:1922,e:"ソ連成立",c:"taisho",d:"ソビエト連邦。"},{id:62,y:1923,e:"関東大震災",c:"taisho",d:"首都圏巨大地震。"},
    {id:63,y:1925,e:"普通選挙法",c:"taisho",d:"男子選挙権拡大。"},{id:64,y:1925,e:"治安維持法",c:"taisho",d:"思想弾圧法。"},{id:65,y:1925,e:"ラジオ放送の開始",c:"taisho",d:"情報化。"},
    {id:66,y:1929,e:"世界恐慌",c:"taisho",d:"世界経済崩壊。"},{id:67,y:1931,e:"満州事変",c:"taisho",d:"柳条湖事件契機。"},{id:68,y:1932,e:"五・一五事件",c:"taisho",d:"首相暗殺。"},
    {id:69,y:1933,e:"国際連盟脱退",c:"taisho",d:"日本の孤立。"},{id:70,y:1936,e:"二・二六事件",c:"taisho",d:"軍部クーデター。"},{id:71,y:1937,e:"日中戦争",c:"taisho",d:"盧溝橋事件契機。"},
    {id:72,y:1938,e:"国家総動員法",c:"taisho",d:"戦時体制強化。"},{id:73,y:1939,e:"第二次世界大戦",c:"taisho",d:"世界大戦再発。"},{id:74,y:1940,e:"日独伊三国同盟",c:"taisho",d:"枢軸国形成。"},
    {id:75,y:1941,e:"日ソ中立条約",c:"taisho",d:"不戦合意。"},{id:76,y:1941,e:"太平洋戦争",c:"taisho",d:"真珠湾攻撃。"},{id:77,y:1941,e:"大西洋憲章",c:"taisho",d:"戦後方針。"},
    {id:78,y:1945,e:"ポツダム宣言受諾",c:"taisho",d:"無条件降伏。"},{id:79,y:1945,e:"国際連合成立",c:"taisho",d:"現在の平和組織。"},{id:80,y:1945,e:"冷戦勃発",c:"taisho",d:"米ソ対立。"},
    {id:81,y:1946,e:"日本国憲法公布",c:"modern",d:"三原則明記。"},{id:82,y:1947,e:"日本国憲法施行",c:"modern",d:"正式稼働。"},{id:83,y:1949,e:"北大西洋条約機構",c:"modern",d:"NATO成立。"},
    {id:84,y:1949,e:"中華人民共和国成立",c:"modern",d:"中国共産党。"},{id:85,y:1950,e:"警察予備隊設置",c:"modern",d:"再軍備。"},{id:86,y:1950,e:"特需景気",c:"modern",d:"朝鮮戦争恩恵。"},
    {id:87,y:1950,e:"朝鮮戦争",c:"modern",d:"冷戦下の戦い。"},{id:88,y:1951,e:"サンフランシスコ平和条約",c:"modern",d:"独立回復。"},{id:89,y:1951,e:"日米安全保障条約",c:"modern",d:"軍事同盟。"},
    {id:90,y:1954,e:"自衛隊発足",c:"modern",d:"現在の組織。"},{id:91,y:1955,e:"アジア・アフリカ会議",c:"modern",d:"第三勢力。"},{id:92,y:1956,e:"日ソ共同宣言",c:"modern",d:"国交回復。"},
    {id:93,y:1956,e:"国際連合加盟",c:"modern",d:"国連復帰。"},{id:94,y:1960,e:"日米新安全保障条約",c:"modern",d:"安保改定。"},{id:95,y:1960,e:"アフリカの年",c:"modern",d:"17国独立。"},
    {id:96,y:1962,e:"キューバ危機",c:"modern",d:"核戦争危機。"},{id:97,y:1964,e:"東海道新幹線開通",c:"modern",d:"高度成長象徴。"},{id:98,y:1964,e:"東京オリンピック",c:"modern",d:"復興のアピール。"},
    {id:99,y:1965,e:"日韓基本条約",c:"modern",d:"国交正常化。"},{id:100,y:1965,e:"ベトナム戦争拡大",c:"modern",d:"米軍介入。"},{id:101,y:1972,e:"沖縄返還",c:"modern",d:"本土復帰。"},
    {id:102,y:1972,e:"日中共同声明",c:"modern",d:"国交正常化。"},{id:103,y:1973,e:"石油危機",c:"modern",d:"オイルショック。"},{id:104,y:1975,e:"主要国首脳会議（サミット）",c:"modern",d:"経済会議。"},
    {id:105,y:1978,e:"日中平和友好条約",c:"modern",d:"友好確立。"},{id:106,y:1989,e:"消費税導入",c:"modern",d:"3%開始。"},{id:107,y:1989,e:"ベルリンの壁崩壊",c:"modern",d:"冷戦末期。"},
    {id:108,y:1990,e:"東西ドイツ統一",c:"modern",d:"統合。"},{id:109,y:1991,e:"バブル経済崩壊",c:"modern",d:"不況開始。"},{id:110,y:1991,e:"湾岸戦争",c:"modern",d:"イラク侵攻対抗。"},
    {id:111,y:1991,e:"ソ連解体",c:"modern",d:"冷戦終了。"},{id:112,y:1992,e:"国連平和維持活動（PKO）協力法",c:"modern",d:"自衛隊派遣。"},{id:113,y:1993,e:"EU成立",c:"modern",d:"欧州統合。"},
    {id:114,y:1995,e:"阪神・淡路大震災",c:"modern",d:"大震災。"},{id:115,y:1997,e:"地球温暖化防止京都会議",c:"modern",d:"環境会議。"},{id:116,y:1998,e:"長野オリンピック",c:"modern",d:"冬季五輪。"},
    {id:117,y:2001,e:"アメリカ同時多発テロ",c:"modern",d:"9.11。"},{id:118,y:2002,e:"日朝平壌宣言",c:"modern",d:"拉致問題。"},{id:119,y:2003,e:"自衛隊イラク派遣",c:"modern",d:"人道復興。"},
    {id:120,y:2003,e:"イラク戦争",c:"modern",d:"米英主導戦。"},{id:121,y:2011,e:"東日本大震災",c:"modern",d:"巨大複合災害。"}
];

let wrongs = new Set(JSON.parse(localStorage.getItem('wr_strictly_v10') || '[]'));
let stars = new Set(JSON.parse(localStorage.getItem('st_strictly_v10') || '[]'));
let pool = [], currentQ = null, currentIndex = 0, sessionScore = 0, sessionWrongs = [], userOrderIds = [];

function updateWeakBtn() {
    const totalWeak = wrongs.size + stars.size;
    document.getElementById('weak-btn').style.display = (totalWeak > 0) ? 'block' : 'none';
    document.getElementById('w-bad').innerText = wrongs.size;
    document.getElementById('s-bad').innerText = stars.size;
}

function startQuiz(mode) {
    if(mode === 'weak') {
        const combined = [...new Set([...Array.from(wrongs), ...Array.from(stars)])];
        pool = db.filter(i => combined.includes(i.e));
    } else {
        pool = mode === 'all' ? [...db] : db.filter(i => i.c === mode);
    }
    pool.sort(() => Math.random() - 0.5);
    currentIndex = 0; sessionScore = 0; sessionWrongs = [];
    document.getElementById('menu').style.display = 'none';
    document.getElementById('nav-bar').style.display = 'flex';
    document.getElementById('prog-ui').style.display = 'block';
    document.getElementById('summary').style.display = 'none';
    document.getElementById('quiz').style.display = 'block';
    next();
}

function next() {
    if(currentIndex >= pool.length) return showSummary();
    document.getElementById('res-box').style.display = 'none';
    document.getElementById('decide-btn').style.display = 'none';
    document.getElementById('back-btn').disabled = (currentIndex === 0);
    document.getElementById('prog-txt').innerText = `${currentIndex + 1} / ${pool.length} 問`;
    document.getElementById('bar-fill').style.width = `${((currentIndex+1)/pool.length)*100}%`;
    document.getElementById('session-correct').innerText = sessionScore;
    if(currentIndex % 3 === 2 && (pool.length - currentIndex) >= 3) setupOrder(); else setupYear();
}

function setupYear() {
    currentQ = { ...pool[currentIndex], type:'year' };
    document.getElementById('q-txt').innerText = `「${currentQ.e}」は何年？`;
    document.getElementById('choices').style.display = 'block';
    document.getElementById('orders').style.display = 'none';
    const area = document.getElementById('choices'); area.innerHTML = '';
    let opts = [currentQ.y];
    while(opts.length < 4) {
        let r = db[Math.floor(Math.random()*db.length)].y;
        if(!opts.includes(r)) opts.push(r);
    }
    opts.sort(() => Math.random() - 0.5);
    opts.forEach(y => {
        const b = document.createElement('button'); b.className = 'choice-btn'; b.innerText = `${y}年`;
        b.onclick = () => finish(y === currentQ.y, `正解：${currentQ.y}年`);
        area.appendChild(b);
    });
}

function setupOrder() {
    let sub = pool.slice(currentIndex, currentIndex + 3);
    currentQ = { correctIds: [...sub].sort((a,b) => a.y - b.y).map(i => i.id), type:'order', items: sub };
    document.getElementById('q-txt').innerText = "古い順に3つ選んでください\n(再タップで解除)";
    document.getElementById('choices').style.display = 'none';
    document.getElementById('orders').style.display = 'block';
    userOrderIds = []; renderOrder();
}

function renderOrder() {
    const area = document.getElementById('orders'); area.innerHTML = '';
    currentQ.items.forEach(item => {
        const d = document.createElement('div'); d.className = 'order-item';
        const sIdx = userOrderIds.indexOf(item.id);
        if(sIdx !== -1) { d.classList.add('selected'); d.innerHTML = `<span class="num-circle">${sIdx+1}</span>${item.e}`; }
        else { d.innerText = item.e; }
        d.onclick = () => {
            const i = userOrderIds.indexOf(item.id);
            if(i === -1) { if(userOrderIds.length < 3) userOrderIds.push(item.id); }
            else { userOrderIds.splice(i, 1); }
            renderOrder();
        };
        area.appendChild(d);
    });
    document.getElementById('decide-btn').style.display = (userOrderIds.length === 3) ? 'block' : 'none';
}

function evalOrder() {
    const ok = userOrderIds.every((v, i) => v === currentQ.correctIds[i]);
    const ansTxt = currentQ.correctIds.map((id, idx) => {
        const item = db.find(x => x.id === id);
        return `${idx+1}. ${item.y}年: ${item.e}`;
    }).join('<br>');
    finish(ok, "【正しい順序】<br>" + ansTxt);
}

function finish(ok, msg) {
    document.getElementById('decide-btn').style.display = 'none';
    document.getElementById('res-box').style.display = 'block';
    const j = document.getElementById('judge-txt');
    if(ok) { j.innerText = "⭕ 正解！"; j.style.color = "var(--correct)"; sessionScore++; 
        if(currentQ.type === 'year') wrongs.delete(currentQ.e); else currentQ.items.forEach(it => wrongs.delete(it.e));
    } else { j.innerText = "❌ 不正解"; j.style.color = "var(--wrong)"; 
        if(currentQ.type === 'year') { wrongs.add(currentQ.e); sessionWrongs.push(currentQ); }
        else { currentQ.items.forEach(it => wrongs.add(it.e)); sessionWrongs.push(currentQ.items[0]); }
    }
    document.getElementById('exp-txt').innerHTML = `<strong>${msg}</strong><br><br>${currentQ.d || ""}`;
    updateStarBtn(); save();
}

function toggleStar() {
    if(stars.has(currentQ.e)) stars.delete(currentQ.e); else stars.add(currentQ.e);
    updateStarBtn(); save();
}

function updateStarBtn() {
    const btn = document.getElementById('star-btn');
    if(stars.has(currentQ.e)) { btn.innerText = "★ チェック済み"; btn.style.opacity = "0.6"; }
    else { btn.innerText = "★ 自信がない（後で復習）"; btn.style.opacity = "1"; }
}

function goNext() { currentIndex++; next(); }
function goBack() { if(currentIndex > 0) { currentIndex--; next(); } }
function backToMenu() {
    document.getElementById('quiz').style.display = 'none'; document.getElementById('prog-ui').style.display = 'none';
    document.getElementById('nav-bar').style.display = 'none'; document.getElementById('summary').style.display = 'none';
    document.getElementById('menu').style.display = 'block'; updateWeakBtn();
}

function showSummary() {
    document.getElementById('quiz').style.display = 'none'; document.getElementById('nav-bar').style.display = 'none';
    document.getElementById('summary').style.display = 'block';
    document.getElementById('final-pct').innerText = `${Math.round((sessionScore / pool.length) * 100)}%`;
    let gem = "【歴史分析依頼】以下の問題で間違えました。解説をお願いします。\n\n" + sessionWrongs.map(w => `・${w.y}年：${w.e}`).join("\n");
    document.getElementById('gemini-text').value = gem;
}
function copyGemini() { document.getElementById('gemini-text').select(); document.execCommand('copy'); alert("コピーしました！"); }
function save() { 
    localStorage.setItem('wr_strictly_v10', JSON.stringify(Array.from(wrongs))); 
    localStorage.setItem('st_strictly_v10', JSON.stringify(Array.from(stars))); 
}
</script>
</body>
</html>
